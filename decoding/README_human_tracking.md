# 人体跟踪3D可视化器

这是一个基于PyQtGraph OpenGL的实时人体跟踪3D可视化器，用于显示IWR6843雷达跟踪的人体目标。

## 功能特性

- **实时3D可视化**: 使用PyQtGraph OpenGL进行高性能3D渲染
- **人体模型**: 支持简化模型（火柴人）和详细模型（3D人体）
- **轨迹跟踪**: 显示人体运动轨迹，可调节轨迹长度
- **点云显示**: 实时显示雷达点云数据
- **多目标跟踪**: 支持同时跟踪多个人体目标
- **交互控制**: 提供丰富的用户界面控制选项
- **统计信息**: 实时显示帧率、目标数量等统计信息

## 文件结构

```
├── human_tracking_3d_visualizer.py  # 主可视化器程序
├── human_model_3d.py                # 3D人体模型类
├── test_visualizer.py               # 测试程序（使用模拟数据）
├── real_time_radar_reader.py        # 雷达数据读取器
├── graph_utilities.py               # 图形工具函数
├── parseFrame.py                    # 数据解析模块
└── README_human_tracking.md         # 使用说明
```

## 安装依赖

确保已安装以下Python包：

```bash
pip install PySide2 pyqtgraph numpy pyserial
```

## 使用方法

### 1. 使用真实雷达数据

```bash
python human_tracking_3d_visualizer.py
```

程序启动后：
1. 点击"连接雷达"按钮连接IWR6843雷达
2. 程序会自动发送配置文件并开始读取数据
3. 在3D视图中观察人体跟踪效果

### 2. 使用模拟数据测试

```bash
python test_visualizer.py
```

测试程序会使用模拟数据，无需连接真实雷达设备。

## 界面说明

### 控制面板

- **连接控制**: 连接/断开雷达设备
- **显示控制**: 
  - 显示轨迹：开启/关闭运动轨迹显示
  - 显示人体模型：开启/关闭3D人体模型
  - 轨迹长度：调节轨迹显示长度（5-100帧）
  - 点大小：调节点云显示大小（1-20像素）
  - 人体模型：选择简化模型或详细模型

### 统计信息

- 帧数：已处理的帧数
- 帧率：当前数据处理帧率
- 跟踪目标：当前检测到的人体目标数量
- 点云数量：当前帧的点云数量

### 3D视图

- **坐标轴**: 红色X轴，绿色Y轴，蓝色Z轴
- **网格**: 地面网格参考
- **点云**: 绿色半透明点表示雷达检测到的点
- **人体模型**: 彩色3D模型表示跟踪的人体目标
- **轨迹线**: 彩色线条表示人体运动轨迹

## 人体模型类型

### 简化模型（火柴人）
- 使用线条和球体表示人体
- 性能较好，适合实时显示
- 包含头部、躯干、四肢的基本结构

### 详细模型（3D人体）
- 使用3D网格表示人体各部分
- 包含头部（球体）、躯干（长方体）、四肢（圆柱体）
- 更真实的人体外观，但性能要求较高

## 配置说明

### 串口配置
默认串口配置：
- CLI串口：COM4
- 数据串口：COM6
- 波特率：921600

如需修改，请编辑`human_tracking_3d_visualizer.py`中的参数：

```python
visualizer = HumanTrackingVisualizer(cli_port='COM3', data_port='COM5')
```

### 雷达配置文件
程序会自动读取`3m.cfg`配置文件。确保该文件存在并包含正确的雷达参数。

## 性能优化

1. **降低更新频率**: 修改`update_timer.start(50)`中的数值（毫秒）
2. **减少轨迹长度**: 使用较短的轨迹长度减少内存占用
3. **使用简化模型**: 在性能受限时选择简化人体模型
4. **关闭不必要的显示**: 关闭轨迹或人体模型显示以提高性能

## 故障排除

### 常见问题

1. **串口连接失败**
   - 检查串口号是否正确
   - 确认雷达设备已连接
   - 检查串口是否被其他程序占用

2. **3D显示异常**
   - 确保显卡驱动支持OpenGL
   - 检查PyQtGraph版本兼容性
   - 尝试降低更新频率

3. **数据解析错误**
   - 检查雷达配置文件是否正确
   - 确认数据格式与解析模块匹配
   - 查看控制台错误信息

### 调试模式

启用详细日志输出：

```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

## 扩展功能

### 添加新的人体模型

1. 在`human_model_3d.py`中创建新的模型类
2. 继承基础模型类并实现必要的方法
3. 在`HumanModelFactory`中注册新模型类型

### 自定义颜色方案

修改`get_trackColors`函数或直接设置颜色：

```python
self.track_colors = [(1, 0, 0, 1), (0, 1, 0, 1), (0, 0, 1, 1)]  # 红绿蓝
```

### 添加数据记录功能

```python
# 在update_visualization方法中添加数据保存
if frame_data:
    with open('tracking_data.json', 'a') as f:
        json.dump(frame_data, f)
        f.write('\n')
```

## 技术细节

### 数据格式

雷达数据格式：
```python
{
    'pointCloud': [[x, y, z, doppler], ...],  # 点云数据
    'numDetectedPoints': int,                  # 点云数量
    'trackData': [[id, x, y, z, vx, vy, vz], ...],  # 跟踪数据
    'numDetectedTracks': int,                  # 跟踪目标数量
    'timestamp': float                         # 时间戳
}
```

### 坐标系

- X轴：左右方向（正右负左）
- Y轴：前后方向（正前负后）
- Z轴：上下方向（正上负下）

### 性能指标

- 典型帧率：20-30 FPS
- 内存占用：约50-100MB
- CPU使用率：10-30%（取决于数据量和显示选项）

## 许可证

本项目基于MIT许可证开源。

## 贡献

欢迎提交Issue和Pull Request来改进这个项目。

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交GitHub Issue
- 发送邮件至项目维护者 